<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Language" content="en">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
    <title>Chordak Keyboard Layout: One Handed Typing</title>

    <style>
      :root {
        --color-stark: #fff;
        
        --color-cream: #f0f2e5;

        --color-stark-glow: #ddd;
        --color-neutral: #ddd;
        --color-neutral-glow: #aaa;
        --color-muted: #333;

        --color-correct: #8eeef6;
        --color-correct-glow: #8eeef6;
        --color-mistake: #e4648a;
        --color-mistake-glow: #e4648a;

        --color-background: #12120f;
        --color-chordak: #21211f; /*#1b1b18*/
        --color-foreground: #21211f;
        

        --color-accent: #7bd507;/*orange #e38563; green #96E363;*/

        --font-mono: 'Menlo', courier, monospace;
        /*--font-mono: 'SF Mono', courier, monospace;*/
        /*--font-mono: 'DejaVu Sans Mono', courier, monospace;*/
        --font-sans: "Open Sans", courier;
        --font-block: "Open Sans", courier;
        --font-brand: "Open Sans", courier;
        /* alt correct C2DAB1, D0E1A7, 55D9C0, B4C76D, 77ACA1, 77EAAC, 7FFCD1, 5BE4A7, 8EEEF6 */
        /* alt error DB7D9E,DF8F8C */
        /* misc colors AACFD8, F4C437 */
        --color-debug-pink: deepPink;
        --color-debug-aqua: Aquamarine;
        --color-debug-coral: Coral;
        --color-debug-gold: Gold;
      }

      html {
        font-size:62.5%; /* 1rem = 10 css pixels */
        background: var(--color-background);
      }

      body {
        width: 100%;
        height: 100%;
        margin:0;
        padding:0;
        background: var(--color-background);
        position: fixed;

        /* essential for mobile safari experience 
        -webkit-tap-highlight-color:rgba(0,0,0,0);
        /*cursor:pointer;*/
      }

      /* footer ----------------------------------------------- */
      
      footer {
        width: calc(100% - 2.5rem);
        height: 5.5rem;

        display: flex;
        justify-content: flex-start;

        position: fixed;
        bottom:0;
        margin: 0 2.5rem 2.5rem 0;
          
        border-width: 0 0 0.1rem 0;
        border-style: solid;
        border-color: #222;
        
      }

      footer #chordak {
        flex: 0 1 18rem;
        min-width: 14.5rem;
        position: relative;
        text-align: right;
        background: var(--color-chordak);
        /*margin-right: 0.5rem;*/
        color: var(--color-cream);
      }

      footer #chordak div {
        position: absolute;
        bottom: 0.7rem;
        right: 1rem;
        font-family: var(--font-brand);
        font-size: 2rem;
        line-height: 2rem;
        /*border: 1px solid red;*/
        font-weight: bold;
        /*color:#ddd;*/

      }

      footer .menu {
        flex: 0 1 6rem;
        height: 100%;
        position: relative;
        text-decoration: none;
        color: #bbbbb9;
        /*border: 1px solid #111166;*/
      }

      footer .menu img {
        position: absolute;
        top:0.5rem;
        width: 6rem;
        height: 6rem;

      }

      footer .menu div {
        font-family: var(--font-block);
        position: absolute;
        bottom:0.4rem;
        font-size: 1.1rem;
        height: 2rem;
        width: 100%;
        line-height: 2rem;
        text-transform: uppercase;
        text-align: center;
      }

      /* asides ----------------------------------------------- */

      aside {
        width: 22.5rem;
        height: 100%;
        position: fixed;
        top:0;
        z-index: 2;
        /*background: green;*/
      }

      aside .inner {
        height: 100%;
        position: absolute;
        background-color: var(--color-foreground);
        overflow: scroll;
      }

      aside .icon {
        width:1.6rem;
        height:1.6rem;
        position: absolute;
        bottom: calc(50% - 0.8rem);
      }

      /* aside left ------------------------------------------- */

      aside.left {
        left: 0;
        transform: translate3d(-17.5rem, 0, 0);
        transition: transform 300ms ease;
      }

      aside.left .inner {
        right: 2.5rem;
        width: 20rem;
        padding: 0 2.5rem;
        box-shadow: 0.5rem 0 0.5rem -0.15rem black;
        font-family: var(--font-sans);
        font-size: 1.2rem;
        color: var(--color-neutral);
      }

      aside.left.open {
        transform: translate3d(5rem, 0, 0);
      }

      aside.left .icon {
        right: 2.95rem;
        opacity: 0.8;
        transition: opacity 200ms ease;
      }

      aside.left.open .icon {
        opacity: 0;
      }

      /* aside right ------------------------------------------ */

      aside.right {
        right: 0;
        transform: translate3d(17.5rem, 0, 0);
        transition: transform 300ms ease;
      }

      aside.right .inner {
        left: 2.5rem;
        width: 20rem;
        padding: 0 2.5rem;
        box-shadow: -0.5rem 0 0.5rem -0.15rem black;
      }

      aside.right.open {
        transform: translate3d(-5rem, 0, 0);
      }

      aside.right .icon {
        left: 0.45rem;
        transition: opacity 200ms ease;
        opacity: 0.8;
        /* these lines necessary because this icon is text */
        font-family: var(--font-sans);
        font-size: 1.8rem;
        line-height: 1.6rem;
        color: white;       
      }

      aside.right.open .icon {
        opacity: 0;
      }

      /* main ------------------------------------------------- */

      main {
        width: 100%;
        height: calc(100% - 8.7rem);
          display: -webkit-flex;
        display: flex;
        flex-direction: column;
        justify-content: space-around; /*flex-start;*/
        align-items: center;
        /*background-color: var(--color-debug-coral);*/
      }

      /* main paper ------------------------------------------- */

      #paper {
        max-width: 82.0rem;
        padding: 0 1rem 0 1rem;
        width: calc(100% - 12rem);
        /*margin: 5rem;*/
        height: calc(1.7*1.5rem*3);
        min-height: calc(1.7*1.5rem*3);
        /*max-height: calc(1.7*1.5rem*3  + 0.6rem);*/
        margin: 5rem auto 0 auto;
        box-shadow: 0rem 0rem 0.5rem 0.2rem black;
        /*background-color: rgb(26,26,26);*/
        background: green;
        overflow: hidden;

        font-family: var(--font-mono);
        font-size: 1.7rem;
      }
      /*
      width data
      ----------
      min-width: 82.0 rem (for 80 char)
      */


      #paper .line {
        width: 100%;
        height: calc(1.7rem*1.5);
        color: rgb(221, 221, 221); /*221-238*/
        white-space: nowrap;
        /*background-color: #333;*/
        background: var(--color-background); /*remove eventually*/
      }

      /*#line-0 { background-color: #444; }
      #line-1 { background-color: #555; }
      #line-2 { background-color: #666; }*/

      #paper span.c { /* correct */
        color: #48483e;
      }

      #paper span.m { /* mistake */
        color: #e4648a;
      }

      .caret {
        background: #48483e;
        color:#fff;
        /*background-color: #eee;*/
        /*color:#222;*/
        border-radius: 0.1rem;
      }

      /*line-height: 1.5rem;*/
        /*yellow #D1C27F*/
        /*green, not bad B4C76D*/

              /* 96E363*/
        /* alt correct C2DAB1, D0E1A7, 55D9C0, B4C76D, 77ACA1, 77EAAC, 7FFCD1, 5BE4A7, 8EEEF6 */
        /* alt error DB7D9E,DF8F8C */
        /* misc colors AACFD8, F4C437 */

      .undefined {
        background-color: #e7db75;
        color:#48483e;
        border-radius: 0.1rem;
        /*--color-accent: #7bd507;orange #e38563; green #96E363;*/

      }

      /* main keybord ----------------------------------------- */

      #keyboard {
        width: 84rem;
        min-height: 26rem;
        flex: 0 0;
          display: -webkit-flex;
        display: flex;
        flex-direction: column;
        justify-content: center;
        font-size: 1rem;
        
        /*position: relative;*/
        overflow: hidden;
        /*background-color: green;*/
        /*border-top: 2px solid #111;*/

          /*-webkit-box-shadow: 0.5rem 0 0.5rem -0.2rem black;*/
        /*box-shadow: 0 -0.5rem 1rem 0 black;*/
      }
      
      #keyboard.left {
        width: 40rem;
        font-size: 1rem;
      }
      #keyboard.right {
        width: 50rem;
        font-size: 1rem;
      }

      /*#keyboard.left .inner {
        flex: 1 0 84rem;
        min-width: 50rem;
        max-width: 84rem;
        width: 50rem;
        margin: auto;
      }
      #keyboard.right .inner {
        width: 50rem;
        margin-left: -35rem;
        padding-right: 35rem;
      }*/

      #keyboard #overlay {
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 1;
        /*border: 0.1rem solid yellow;*/
      }

      #keyboard.left #overlay {
        background: -webkit-linear-gradient(22deg, 
          rgba(17,17,17,0) 60%,
          rgba(17,17,17,1) 82%);
      }
      #keyboard.right #overlay {
        margin-left: 35rem;
        background: -webkit-linear-gradient(-158deg, 
          rgba(17,17,17,0) 81%,
          rgba(17,17,17,1) 93%);
      }

      #keyboard .row {
          display: -webkit-flex;
        display: flex;
      }

      #keyboard .row .key {
        flex: 0 0 4.8rem;
        height: 4.8rem;
        font-size: 1.8rem;

          display: -webkit-flex;
        display: flex;
        justify-content: center;
        align-items: center;
        border-style: solid;
        border-width: .2rem;
        border-radius: 2.6rem;
        border-color: #555;
        color: #bbb;
        margin: 0.4rem;
        font-family: "Open Sans";
      }

      #keyboard .row .key.text {
        font-size: 0.9rem;
      }

      #keyboard .row .key.pressed {
          -webkit-transform: scale(0.95, 0.95);
          -ms-transform: scale(0.95, 0.95);
        transform: scale(0.95, 0.95);
        color:#FFF;
        border-color: #fff;
        box-shadow: 0rem 0rem 1.8rem #bbb;
      }

      #keyboard .row .key.pressed-wrong {
          -webkit-transform: scale(0.95, 0.95);
          -ms-transform: scale(0.95, 0.95);
        transform: scale(0.95, 0.95);
        color:#E4648A;
        border-color: #E4648A;
        box-shadow: 0rem 0rem 1.8rem #E4648A;
      }

      #keyboard .row .key.pressed-correct {
          -webkit-transform: scale(0.95, 0.95);
          -ms-transform: scale(0.95, 0.95);
        transform: scale(0.95, 0.95);
        color:#8EEEF6;
        border-color: #8EEEF6;
        box-shadow: 0rem 0rem 1.8rem #8EEEF6;
      }

      #keyboard .row .key.caps {
        margin-left: 2.5rem;
      }
      #keyboard .row .key.shift {
        margin-left: 5.4rem;
      }
      #keyboard .row .key.command {
        margin-left: 17.4rem;
      }
      #keyboard .row .key.space {
        flex: 0 0 28.8rem;
        border-radius: 2.5rem;
      }

      #keyboard .row .key.stack {
        font-size: 1.6rem;
        line-height: 1.8rem;
        align-content: center;
      }

      #keyboard .row .itsy {
        line-height: 50%;
        font-size: 150%;
      }

      /* chords legend ---------------------------------------- */

      #nameless {
        width:20rem;
        height:10rem;
        margin: 0.4rem 0 0.6rem 0;
        /*background-color: green;*/
        position: relative;
      }
      #nameless .legend {
        width: 6rem;
        height: 10rem;
      }
      #nameless .legend img {
        width: 6rem;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        opacity: 0.9;
      }

      #nameless .legend div {
        font-family: var(--font-mono);
        font-size: 1.3rem;
        position: absolute;
      }
      #nameless .legend .pinkie {
        top:1.4rem;
        left:0.4rem;
      }
      #nameless .legend .ring {
        top:0.9rem;
        left:1.3rem;
      }
      #nameless .legend .middle {
        top:0.4rem;
        left:2.4rem;
      }
      #nameless .legend .index {
        top:1.2rem;
        left:3.4rem;
      }
      #nameless .legend .thumb {
        top:4.1rem;
        left:5rem;
      }

      #nameless .legend.right img {
        -moz-transform: scaleX(-1);
        -o-transform: scaleX(-1);
        -webkit-transform: scaleX(-1);
        transform: scaleX(-1);
      }
      #nameless .legend.right .pinkie { left:4.8rem; }
      #nameless .legend.right .ring { left:3.7rem; }
      #nameless .legend.right .middle { left:2.8rem; }
      #nameless .legend.right .index { left:1.7rem; }
      #nameless .legend.right .thumb { left:0.1rem; }

      #nameless .info {
        width: 11.5rem;
        height: 8rem;
        padding: 1rem;
        position: absolute;
        top: 0;
        right: 0;
        font-family: var(--font-sans);
        font-size: 1.2rem;
        text-align: left;
        /*background-color: yellow;*/

      }

      /* chords ----------------------------------------------- */


      #chords {
        width: 20rem;
        /*height: calc(100% - 3rem);*/
        /*margin-top: 1.5rem;*/
        /*background-color: var(--color-debug-pink);*/
      }

      #chords div {
        width: 100%;
          display: -webkit-flex;
        display: flex;
        justify-content: space-between;
        font-family: var(--font-mono);
        font-size: 1.3rem;
        border-bottom: 0.1rem solid #444;
      }

      #chords div span {
        width: 3rem;
        height: 1.8rem;
        line-height: 1.8rem;
        height: 100%;
        
        
        text-align: center;
        color: #ddd;
        overflow: hidden;
      }

      #chords div .c {
        text-align: left;
        width: 4.5rem;
        font-style: italic;
        padding-left: 0.5rem;
        order: 1;
      }
      #chords div .l {
        order: 2;
        background-color: #333;
      }
      #chords div .s {
        order: 5;
      }
      #chords div .b {
        order: 4;
      }
      #chords div .n {
        order: 3;
      }

      #chords .header span {
        background-color: #444;
        font-family: var(--font-sans);
        font-size: 1rem;
      }

      #chords .header .c {
        font-style: initial;
        text-align: center;
        padding: 0;
        padding:0 0.25rem;
      }


/*      #chord-t .l {
        font-family: helvetica;
        font-size: 2rem;
        line-height: 1.7rem;
        color:red;
      }

      #chord-t .l {
        font-family: helvetica;
        font-size: 2rem;
        line-height: 1.7rem;
        color:red;
      }

      #chord-prm .l {
        font-size: 3rem;
        line-height: 1.7rem;
      }

      #chord-rmi .l {
        font-size: 1.8rem;
        line-height: 2rem;
      }*/

      /* custom inputs ---------------------------------------- */

      .input-group {
            display: -webkit-flex;
          display: flex;
          width: 100%;
          height: 6rem;
      }

      .input-group label {
          display: -webkit-flex;
        display: flex;

        /*font-size: 2rem;*/
        width:50%;
        height:100%;
        border: none;
        padding: 0.2rem;

        text-align: center;
        align-items: center;
        justify-content: center;

        /*transition: border 0.2s ease, padding 0.2s ease;*/
      }

      .input-group label span {
        color: #666;
        font-size: 3rem
      }

      .input-group input[type="radio"] {
        display: none;
      }
/*      label + input[type="radio"] {
        color: #666;
      }*/

      .input-group input[type="radio"]:checked + label {
        padding: 0rem;
        border: 0.1rem solid #ccc;

        box-shadow: 0 0 1.2rem #bbb;
      }

      .input-group input[type="radio"]:checked + label span {
        color: #ccc;
      }

      /* toggle checkbox --------------------------------------------------- */
      /*<!-- <input class="toggle" id="sample" name="sample" type="checkbox">
            <label for="sample">
              <div class="description">Sample Label</div>
              <div class="slider"><div class="round"></div></div>
            </label> -->*/
      
      .toggle {
        display:none;
      }

      .toggle+label {
        width: 100%;
        height: 3rem;
          display: -webkit-flex;
        display: flex;
        justify-content: space-between;
        position: relative;
        margin: 1rem 0;
          -webkit-user-select: none;
        user-select: none;
      }

      .toggle+label .description {
        margin: auto 0;
      }

      .toggle+label .slider {
        min-width: 5rem;
        max-width: 5rem;
        height: 2.6rem;
        position: relative;
        border:0.2rem solid var(--color-neutral);
        border-radius: 1.5rem;
        overflow: hidden;
        transition: border-color 0.2s ease;
        cursor: pointer;
      }

      .toggle+label .slider .round {
        width: 1.8rem;
        height: 1.8rem;
        position: absolute;
        right: 2.1rem;
        margin: 0.2rem 0.3rem;
        border:0.2rem solid var(--color-mistake);
        border-radius: 50%;
        box-shadow: 0 0 0.9rem var(--color-mistake-glow);
        transition: right 0.3s ease;
      }

      .toggle:checked+label .slider .round {
        right: 0;
        border-color:#8EEEF6;
        box-shadow: 0 0 0.9rem #8EEEF6;
      }

      .toggle+label .slider.neutral .round {
        width: 1.8rem;
        height: 1.8rem;
        position: absolute;
        right: 2.1rem;
        margin: 0.2rem 0.3rem;        
        text-align: center;
        border-radius: 50%;
        border:0.2rem solid var(--color-neutral);
        box-shadow: 0 0 0.6rem var(--color-neutral-glow);
        color: #eee;
      }

      .toggle:checked+label .slider.neutral .round {
        right: 0;
      }

      /* select & incrementer inputs ----------------------------- */

      .form-container {
        width: 100%;
        height: 3rem;
          display: -webkit-flex;
        display: flex;
        justify-content: space-between;
        align-items: center;        
        position: relative;
        padding: 0.5rem 0;
        overflow: visible;
      }

      .form-container select {
        width: 7rem;
        height: 3rem;
          -webkit-appearance: none;
        appearance: none;
        outline:none;
        background: none;
        border:0.2rem solid var(--color-neutral);
        border-radius: 1.5rem;

        color: #eee;
        text-align: center;
        text-align-last:center;
        font-family: var(--font-sans);
        font-size: 1.1rem;
        padding: 0 1rem 0 1rem;
        cursor: pointer;
      }

      .form-container select:focus {
        box-shadow: 0 0 0.9rem var(--color-neutral-glow);
      }

      .form-spacer-1 {
        width:100%;
        height:0.5rem;
      }

      .form-spacer-2 {
        width:100%;
        height:1.5rem;
      }

      .form-container .incrementer {
        width:5.4rem;
        height:3.0rem;
        position: relative;
        border-radius:1.5rem;
        background: none;
      }
      /* 5rem - 0.4rem outer border - 0.2rem mid border = 4.4rem */

      .form-container .incrementer input {
        width: 2.7rem;
        height: 100%;
        position:absolute;
        top:0;
        -webkit-appearance: none;
        appearance: none;
        outline:none;
        background: none;
        border:none;
        font-family: var(--font-mono);
        font-size: 1.4rem;
        text-align: center;
        color: var(--color-stark);
        border:0.2rem solid var(--color-neutral);
      }

      .form-container .incrementer .left {
        left:0;
        border-width: 0.2rem 0.1rem 0.2rem 0.2rem;
        border-radius: 1.5rem 0 0 1.5rem;
      }

      .form-container .incrementer .right {
        right:0;
        border-width: 0.2rem 0.2rem 0.2rem 0.1rem;
        border-radius: 0 1.5rem 1.5rem 0;
      }

      .form-container .incrementer input:active {
        box-shadow: 0 0 0.8rem var(--color-neutral-glow);
      }

      #reset-button {
        width: 100%;
        height: 3rem;
          -webkit-appearance: none;
        appearance: none;
        outline:none;
        background: none;
        margin-bottom: 2rem;
        border:0.2rem solid var(--color-mistake-glow);
        border-radius: 1.5rem;
        color: var(--color-mistake);
        font-family: var(--font-sans);
        font-size: 1rem;
        text-transform: uppercase;
      }

      #reset-button:active {
        box-shadow: 0rem 0rem 0.9rem #E4648A;
      }

      hr {
        border: 0.15rem solid var(--color-muted);
      }

      /* custom layout ----------------------------- */

      #custom-layout {
        width:19.2rem;
        /*width: calc(100% - 0.4rem);*/
          display: -webkit-flex;
        display: flex;
        flex-direction: column;
        padding:0.1rem;
        border-radius: 1.5rem;
        margin: 0.5rem auto 1rem auto;
        /*background: var(--color-debug-pink);*/
      }

      #custom-layout .row {
          display: -webkit-flex;
        display: flex;
        justify-content: flex-start;
      }

      #custom-layout .row .key {
        width: 2.6rem;
        height: 2.6rem;
        margin: 0.1rem;
        border:0.2rem solid var(--color-mistake-glow);
        border-radius: 1.5rem;
        text-align: center;
        line-height: 2.6rem;
        font-size: 0.9rem;
        font-family: var(--font-sans);
        color: var(--color-stark);
        box-shadow: 0 0 0.4rem var(--color-mistake-glow);
      }

      #custom-layout .row .key.set {
        border-color: var(--color-muted);
        box-shadow: none;
      }

      #custom-layout.left .row {
        justify-content: flex-end;
      }

      #custom-layout.right .row {
        justify-content: flex-start;
      }

      #custom-layout.left .row .key.num {
        order:0;
      }
      #custom-layout .row .key.thumb {
        width: 5.8rem;
        order:1;
      }

      #custom-layout.right .row .key.num {
        order:1;
      }
      #custom-layout.right .row .key.thumb {
        width: 5.8rem;
        order:0;
      }

      @media screen and (max-height: 350px) {
          footer {
            margin-bottom: 1rem;
          }
          #keyboard {
              display:none;
          }
      }
    </style>
  </head>


    <!-- <span style="color:#444">Aa Bb Cc De Ee Ff Gg Hh Ii Jj Kk Ll Mm Nn Oo Pp Qq Rr Ss Tt Uu Vv</span>
    
    <span style="color:#666">The quick brown fox jumps over </span><span style="color:#ddd">the lazy dog. 0123456789 l1I 0O</span>
    
    <span style="color:#bbb">. , ' " ; : ! @ # $ % ^ &amp; * _ + - &ndash; &mdash; = (0) {} [] < > / ? \ | ` ~</span>
    -->

    <!-- <div class="line l0"><span class="c">-===10===--===20===--===30===--===40===--===50===--===60===--===70===--===80===-</span></div>
        <div class="line l1">
          <span class="c">AaBb<span class="m">C</span>cDeEeFfGg</span><span class="caret">H</span>hIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz 0123456789 O0 l1Il
        </div>
        <div class="line l2">
          jumps over the lazy dog. This line should be long enough to wrap onto the follow
        </div> -->

  <body>
    <main>
      <div id="paper">
        <div id="line-0" class="line">A</div>
        <div id="line-1" class="line">B</div>
        <div id="line-2" class="line">C</div>
        <div id="line-3" class="line">D</div>
        <div id="line-4" class="line">E</div>
      </div> <!-- paper -->

      <div id="keyboard">
        <div class="row">
          <div class="key text">ESC</div>
          <div class="key text">HYPER</div>
          <div class="key text">BRACES</div>
          <div class="key text">MOVE</div>
          <div class="key text">MARKS</div>
          <div class="key text">TAB</div>
          <div class="key text">TAB</div>
          <div class="key text">MARKS</div>
          <div class="key text">MOVE</div>
          <div class="key text">BRACES</div>
          <div class="key text">HYPER</div>
          <div class="key text">ESC</div>
          <div class="key"></div>
          <div class="key"></div>
        </div>
        
        <div class="row">
          <div class="key caps text">DELETE</div>
          <div class="key pressed-wrong"></div>
          <div class="key pressed-wrong"></div>
          <div class="key pressed-correct"></div>
          <div class="key pressed"></div>
          <div class="key">&crarr;</div>
          <div class="key text">RETURN</div>
          <div class="key pressed-wrong"></div>
          <div class="key pressed"></div>
          <div class="key"></div>
          <div class="key pressed-correct"></div>
          <div class="key text">DELETE</div>
          <div class="key return text"></div>
        </div>

        <div class="row">
          <div class="key shift">&#x21E7;</div>
          <div class="key text">FN</div>
          <div class="key text">CTRL</div>
          <div class="key ">&#8997;</div>
          <div class="key">&#x2318;</div>
          <div class="key">&#x21E7;</div>
          <div class="key">&#x2318;</div>
          <div class="key">&#8997;</div>
          <div class="key text">CTRL</div>
          <div class="key text">FN</div>
          <div class="key">&#x21E7;</div>
          <div class="key"></div>
        </div>

        <div class="row">
          <div class="key command">#...</div>
          <div class="key pressed space"></div>
          <div class="key">#...</div>
        </div>

        <div id="overlay"></div>
      </div> <!-- keyboard -->
    </main>
    
    <aside id="aside-left" class="left">
      <div class="inner">
        <br>
        <label for="simulate-layout" class="form-container">
          <div>Typing Mode</div>
          <select id="simulate-layout" name="simulate-layout" style="width:9rem;">
            <option value="" selected>Lessons</option>
            <option value="">Speed Test</option>
            <option value="">Copy Text</option>
            <option value="">Blank</option>
          </select>
        </label>

        <label for="simulate-layout" class="form-container">
          <div>Lesson</div>
          <select id="simulate-layout" name="simulate-layout" style="width:13rem;">
            <optgroup label="Alphabet">
              <option value="">o a t e _</option>
              <option value="">g v w y</option>
              <option value="">d f k l</option>
              <option value="">i p q r</option>
              <option value="">h n s z</option>
              <option value="">b c m u</option>
              <option value="">x&nbsp;&nbsp;j&nbsp;&nbsp;,&nbsp;&nbsp;.</option>
            </optgroup>

            <optgroup label="Practice">
              <option value="">Common Bigrams</option>
              <option value="">Common Trigrams</option>
              <option value="">Common Words</option>
              <option value="">Pangrams</option>
              <option value="">abc...</option>
              <option value="">a b c...</option>
              <option value="">Random Letters</option>
              <option value="">Opposite Chords</option>
            </optgroup>

            <optgroup label="Formatting">
              <option value="">Navigation</option>
              <option value="">Return</option>
              <option value="">Tab</option>
            </optgroup>

            <optgroup label="Capitals">
              <option value="">Shift Left</option>
              <option value="">Shift Right</option>
              <option value="">Aa Bb Cc...</option>
              <option value="">Capital Bigrams</option>
              <option value="">Capital Trigrams</option>
              <option value="">Capital Words</option>
              <option value="">Caps Lock</option>
              <option value="">Acronyms</option>
            </optgroup>

            <optgroup label="Numerals">
              <option value="">0 1 2 3</option>
              <option value="">4 7 9</option>
              <option value="">5 8 6</option>
              <option value="">Num Lock*</option>
              <option value="">123...</option>
              <option value="">Random Numbers</option>
              <option value="">Formatted Numbers</option>
              <option value="">Alphanumeric</option>
            </optgroup>

            <optgroup label="Brackets">
              <option value="">( )&nbsp;&nbsp;Round</option>
              <option value="">[ ]&nbsp;&nbsp;Square</option>
              <option value="">{ }&nbsp;&nbsp;Curly</option>
              <option value="">&lt; &gt;&nbsp;&nbsp;Angle</option>
              <option value="">\ /&nbsp;&nbsp;Slashes</option>
              <option value="">|&nbsp;&nbsp;Vertical Bar</option>
            </optgroup>

            <optgroup label="Symbols">
              <option value="">'&nbsp;&nbsp;Apostrophe</option>
              <option value="">"&nbsp;&nbsp;Quotes</option>
              <option value="">;&nbsp;&nbsp;Semicolon</option>
              <option value="">?&nbsp;&nbsp;Question</option>
              <option value="">!&nbsp;&nbsp;Exclamation</option>
              <option value="">_&nbsp;&nbsp;Underscore</option>
              <option value="">:&nbsp;&nbsp;Colon</option>
              <option value="">+&nbsp;&nbsp;Plus Sign</option>
              <option value="">-&nbsp;&nbsp;Hyphen-Minus</option>
              <option value="">=&nbsp;&nbsp;Equals Sign</option>
              <option value="">@&nbsp;&nbsp;At Sign</option>
              <option value="">&amp;&nbsp;&nbsp;Ampersand</option>
              <option value="">*&nbsp;&nbsp;Asterisk</option>
              <option value="">%&nbsp;&nbsp;Percent Sign</option>
              <option value="">#&nbsp;&nbsp;Number Sign</option>
              <option value="">$&nbsp;&nbsp;Dollar Sign</option>
              <option value="">^&nbsp;&nbsp;Caret</option>
              <option value="">~&nbsp;&nbsp;Tilde</option>
              <option value="">`&nbsp;&nbsp;Grave Accent</option>
            </optgroup>

            <optgroup label="Shortcuts">
              <option value="">Command</option>
              <option value="">Option/Alt</option>
              <option value="">Control</option>
              <option value="">Function</option>
              <option value="">Meta</option>
            </optgroup>

            <optgroup label="Advanced Practice">
              <option value="">Math</option>
              <option value="">Programming</option>
              <option value="">Rare Bigrams</option>
              <option value="">Finger Breakers</option>
            </optgroup>
          </select>
        </label>

        <hr>

        <input class="toggle" id="typing-hand" name="typing-hand" type="checkbox">
        <label for="typing-hand">
          <div class="description">Typing Hand</div>
          <div class="slider neutral"><div id="typing-hand-text" class="round text">L</div></div>
        </label>

        <div class="form-spacer-1"></div>

        <label for="current-layout" class="form-container">
          <div>Current Layout</div>
          <select id="current-layout" name="current-layout">
            <option value="qwerty">QWERTY</option>
            <option value="colemak">Colemak</option>
            <option value="dvorak">Dvorak</option>
            <option value="workman">Workman</option>
            <option value="chordak">Chordak</option>
            <option value="other">Other...</option>
          </select>
        </label>

        <div id="custom-layout" class="left">
          <div class="row above">
            <div class="key set">TAB</div>
            <div class="key set">Q</div>
            <div class="key"></div>
            <div class="key"></div>
            <div class="key"></div>
            <div class="key"></div>
          </div>
          
          <div class="row home">
            <div class="key set">CAPS</div>
            <div class="key"></div>
            <div class="key set">R</div>
            <div class="key set">S</div>
            <div class="key set">T</div>
            <div class="key set">D</div>
          </div>
          
          <div class="row below">
            <div class="key set">SHIFT</div>
            <div class="key set">Z</div>
            <div class="key set">X</div>
            <div class="key"></div>
            <div class="key set">V</div>
            <div class="key set">B</div>
          </div>

          <div class="row gutter left">
            <div class="key num set">&#x2318;</div>
            <div class="key thumb set">SPACE</div>
          </div>
        </div>
        
        <label for="simulate-layout" class="form-container">
          <div>Simulate Layout</div>
          <select id="simulate-layout" name="simulate-layout">
            <option value="none">None</option>
            <option value="chordak" selected>Chordak</option>
            <option disabled></option>
            <option value="colemak">Colemak</option>
            <option value="workman">Workman</option>
            <option value="dvorak">Dvorak</option>
          </select>
        </label>

        <div class="form-spacer-2"></div>
        
        <input class="toggle" id="show-keyboard" name="show-keyboard" type="checkbox" checked>
        <label for="show-keyboard">
          <div class="description">Show Keyboard</div>
          <div class="slider"><div class="round"></div></div>
        </label>

        <input class="toggle" id="show-hints" name="show-hints" type="checkbox" checked>
        <label for="show-hints">
          <div class="description">Show Chord Hints</div>
          <div class="slider"><div class="round"></div></div>
        </label>

        <input class="toggle" id="stagger" name="stagger" type="checkbox" checked>
        <label for="stagger">
          <div class="description">Stagger Keys</div>
          <div class="slider"><div class="round"></div></div>
        </label>

        <input class="toggle" id="sound" name="sound" type="checkbox">
        <label for="sound">
          <div class="description">mistake Sounds</div>
          <div class="slider"><div class="round"></div></div>
        </label>

        <div class="form-container">
          <div>Font Size</div>
          <div class="incrementer">
            <input id="minus-button" class="left" type="button" value="-">
            <input id="plus-button" class="right" type="button" value="+">  
          </div>
        </div>
                  
        <br>

        <input id="reset-button" name="reset-button" value="Reset &amp; Clear Stored Data" type="button">
      </div>
      <img class="icon" src="flower-icon.png"/>
      <!-- <span>&#9835;</span> -->
    </aside>

    <aside id="aside-right" class="right">
      <div class="inner">

        <div id="nameless">
          <div class="legend">
            <img src="hand.gif"/>
            <div class="thumb">t</div>
            <div class="index">i</div>
            <div class="middle">m</div>
            <div class="ring">r</div>
            <div class="pinkie">p</div>
          </div>
          <div class="info" />This is where some additional info could go... and possibly a hide legend button.
          </div>
        </div>

        <div id="chords">
          <div class="header">
            <span class="c">CHORD</span>
            <span class="l">LTR</span>
            <span class="s">NUM</span>
            <span class="b">BKT</span>
            <span class="n">SYM</span>
          </div>

          <div id="chord r">
            <span class="c">r</span>
            <span class="l">A</span>
            <span class="s">;</span>
            <span class="b">/</span>
            <span class="n">2</span>
          </div>

          <div id="chord-pr">
            <span class="c">p&#x00B7;r</span>
            <span class="l">B</span>
            <span class="s">@</span>
            <span class="b">|</span>
            <span class="n">4</span>
          </div>

          <div id="chord-pt">
            <span class="c">p&#x00B7;t</span>
            <span class="l">C</span>
            <span class="s">_</span>
            <span class="b"></span>
            <span class="n"></span>
          </div>

          <div id="chord-it">
            <span class="c">i&#x00B7;t</span>
            <span class="l">D</span>
            <span class="s">=</span>
            <span class="b">{</span>
            <span class="n"></span>
          </div>

          <div id="chord-i">
            <span class="c">i</span>
            <span class="l">E</span>
            <span class="s">!</span>
            <span class="b">)</span>
            <span class="n">0</span>
          </div>

          <div id="chord-ir">
            <span class="c">i&#x00B7;r</span>
            <span class="l">F</span>
            <span class="s">$</span>
            <span class="b"></span>
            <span class="n"></span>
          </div>

          <div id="chord-tm">
            <span class="c">t&#x00B7;m</span>
            <span class="l">G</span>
            <span class="s"></span>
            <span class="b">&gt;</span>
            <span class="n"></span>
          </div>

          <div id="chord-rt">
            <span class="c">r&#x00B7;t</span>
            <span class="l">H</span>
            <span class="s">-</span>
            <span class="b"></span>
            <span class="n"></span>
          </div>

          <div id="chord-mi">
            <span class="c">m&#x00B7;i</span>
            <span class="l">I</span>
            <span class="s">*</span>
            <span class="b">[</span>
            <span class="n">6</span>
          </div>

          <div id="chord-mit">
            <span class="c">m&#x00B7;i&#x00B7;t</span>
            <span class="l">J</span>
            <span class="s"></span>
            <span class="b"></span>
            <span class="n"></span>
          </div>

          <div id="chord-ip">
            <span class="c">i&#x00B7;p</span>
            <span class="l">K</span>
            <span class="s">~</span>
            <span class="b"></span>
            <span class="n"></span>
          </div>

          <div id="chord-im">
            <span class="c">i&#x00B7;m</span>
            <span class="l">L</span>
            <span class="s">^</span>
            <span class="b">]</span>
            <span class="n"></span>
          </div>

          <div id="chord-pm">
            <span class="c">p&#x00B7;m</span>
            <span class="l">M</span>
            <span class="s">&amp;</span>
            <span class="b"></span>
            <span class="n">7</span>
          </div>

          <div id="chord-rm">
            <span class="c">r&#x00B7;m</span>
            <span class="l">N</span>
            <span class="s">:</span>
            <span class="b"></span>
            <span class="n">5</span>
          </div>

          <div id="chord-p">
            <span class="c">p</span>
            <span class="l">O</span>
            <span class="s">"</span>
            <span class="b">/</span>
            <span class="n">3</span>
          </div>

          <div id="chord-mr">
            <span class="c">m&#x00B7;r</span>
            <span class="l">P</span>
            <span class="s">%</span>
            <span class="b"></span>
            <span class="n"></span>
          </div>

          <div id="chord-mp">
            <span class="c">m&#x00B7;p</span>
            <span class="l">Q</span>
            <span class="s">`</span>
            <span class="b"></span>
            <span class="n"></span>
          </div>

          <div id="chord-mt">
            <span class="c">m&#x00B7;t</span>
            <span class="l">R</span>
            <span class="s">+</span>
            <span class="b">&lt;</span>
            <span class="n"></span>
          </div>

          <div id="chord-ri">
            <span class="c">r&#x00B7;i</span>
            <span class="l">S</span>
            <span class="s"></span>
            <span class="b"></span>
            <span class="n">8</span>
          </div>

          <div id="chord-m">
            <span class="c">m</span>
            <span class="l">T</span>
            <span class="s">?</span>
            <span class="b">(</span>
            <span class="n">1</span>
          </div>

          <div id="chord-pi">
            <span class="c">p&#x00B7;i</span>
            <span class="l">U</span>
            <span class="s">#</span>
            <span class="b"></span>
            <span class="n">9</span>
          </div>

          <div id="chord-tp">
            <span class="c">t&#x00B7;p</span>
            <span class="l">V</span>
            <span class="s"></span>
            <span class="b"></span>
            <span class="n"></span>
          </div>

          <div id="chord-ti">
            <span class="c">t&#x00B7;i</span>
            <span class="l">W</span>
            <span class="s"></span>
            <span class="b">}</span>
            <span class="n"></span>
          </div>

          <div id="chord-rmt">
            <span class="c">r&#x00B7;m&#x00B7;t</span>
            <span class="l">X</span>
            <span class="s"></span>
            <span class="b"></span>
            <span class="n"></span>
          </div>

          <div id="chord-tr">
            <span class="c">t&#x00B7;r</span>
            <span class="l">Y</span>
            <span class="s"></span>
            <span class="b"></span>
            <span class="n"></span>
          </div>
          
          <div id="chord-rp">
            <span class="c">r&#x00B7;p</span>
            <span class="l">Z</span>
            <span class="s"></span>
            <span class="b"></span>
            <span class="n"></span>
          </div>

          <div id="chord-t">
            <span class="c">t</span>
            <span class="l">&#x2423;</span>
            <span class="s">'</span>
            <span class="b"></span>
            <span class="n"></span>
          </div>

          <div id="chord-prm">
            <span class="c">p&#x00B7;r&#x00B7;m</span>
            <span class="l">.</span>
            <span class="s"></span>
            <span class="b"></span>
            <span class="n"></span>
          </div>

          <div id="chord-rmi">
            <span class="c">r&#x00B7;m&#x00B7;i</span>
            <span class="l">,</span>
            <span class="s"></span>
            <span class="b"></span>
            <span class="n"></span>
          </div>
        </div> <!-- chords -->

        <span class="icon">&#9835;</span>
        <!-- <img class="icon" src="flower-icon.png"/> -->
      </div>
      <!-- <span style="color:#fff">
        keep visible
      </span> -->
    </aside>

    <footer>
      <a href="" id="chordak"><div>CHORDAK</div></a>

      <a href="" class="menu"><div>info</div></a>
      <a href="" class="menu"><div>order</div></a>
      <a href="" class="menu"><div>forum</div></a>
      <a href="" class="menu"><div>help</div></a>
    </footer>
    <!-- <div>site design &copy;2017</div> -->

    <!-- woodknock.wav make quieter -->
    <!-- tangel.wav make softer -->
    <audio id="mistake-sound">
      <!-- <source src="sounds/woodknock.mp3" type="audio/mpeg"> -->
      <source src="sounds/mistake.wav" type="audio/wav">
    </audio>

        <audio id="undefined-sound">
      <source src="sounds/undefined.wav" type="audio/wav">
    </audio>

    <script>
      //macbook pro: 68 cN is enough to activate any key; some are softer because of wear from frequent use ('A', 54 cN) or replacement ('D', 48 cN)
        // 'A' 53.9 cN
        // 'S' 62.5 cN
        // 'D' 47.8 cN
        // 'F' 68.6 cN
        // ' ' 68.6 cN (near left edge)

      //cherry brown and clear switches look best so far because the reset point is so close to the activation point, provide tactile feedback, and are not too loud

      /* utility functions ------------------------------------ */

      function $(s) { 
        if (s[0] == '.') {
          return document.getElementsByClassName(s.substr(1));
        }
        return document.getElementById(s);
      }

      // alert($('custom-layout').offsetHeight);
      // function funz(e) {
      // }

      function htmlDecode(input){
        var e = document.createElement('div');
        e.innerHTML = input;
        return e.childNodes[0].nodeValue;
      }

      /* chords ----------------------------------------------- */

      // var chords = {};     

      // //LETTERS
      // chords['1'] = ' ';
      // chords['432'] = ',';
      // chords['543'] = '.';
      // chords['5432'] = '.'; //duplicate for convenience

      // chords['2'] = 'E';
      // chords['3'] = 'T';
      // chords['4'] = 'A';
      // chords['5'] = 'O';
      // chords['32'] = 'I';
      // chords['43'] = 'N';
      // chords['42'] = 'S';
      // chords['41'] = 'H';
      // chords['31'] = 'R';
      // chords['21'] = 'D';
      // chords['23'] = 'L';
      // chords['51'] = 'C';
      // chords['52'] = 'U';
      // chords['53'] = 'M';
      // chords['24'] = 'F';
      // chords['34'] = 'P';
      // chords['13'] = 'G';
      // chords['12'] = 'W';
      // chords['14'] = 'Y';
      // chords['54'] = 'B';
      // chords['15'] = 'V';
      // chords['25'] = 'K';
      // chords['431'] = 'X';
      // chords['321'] = 'J';
      // chords['35'] = 'Q';
      // chords['45'] = 'Z';

      //BIGRAMS & TRIGRAMS
      // chords['341'] = '<u>TH</u>';
      // chords['412'] = '<u>HE</u>';
      // chords['3412'] = '<u>THE</u>';
      // chords['423'] = '<u>ST</u>';

      //NUMERALS
      // chords['1'] = ' ';
      // chords['432'] = ',';
      // chords['543'] = '.';
      // chords['5432'] = '.';

      // chords['2'] = '0';
      // chords['3'] = '1';
      // chords['4'] = '2';
      // chords['5'] = '3';
      // chords['54'] = '4';
      // chords['43'] = '5';
      // chords['32'] = '6';
      // chords['53'] = '7';
      // chords['42'] = '8';
      // chords['52'] = '9';

      //BARS & BRACKETS
      // chords['5'] = '/';
      // chords['4'] = '\\'; // escaped with extra backslash
      // chords['54'] = '|';
      // chords['3'] = '(';
      // chords['2'] = ')';
      // chords['32'] = '[';
      // chords['23'] = ']';
      // chords['21'] = '{';
      // chords['12'] = '}';
      // chords['31'] = '<';
      // chords['13'] = '>';

      //SYMBOLS & PUNCTUATION
      // chords['1'] = "'";
      // chords['5'] = '"';
      // chords['4'] = ';';
      // chords['3'] = '?';
      // chords['2'] = '!';
      // chords['51'] = '_';
      // chords['41'] = '-';
      // chords['31'] = '+';
      // chords['21'] = '=';
      // chords['43'] = ':';
      // chords['54'] = '@';
      // chords['53'] = '&';
      // chords['52'] = '#';
      // chords['32'] = '*';
      // chords['34'] = '%';
      // chords['24'] = '$';
      // chords['23'] = '^';
      // chords['25'] = '~';
      // chords['35'] = '`';

      /* lessons ---------------------------------------------- */

      var lessons = []; 
      lessons[0] = "-===10===--===20===--===30===--===40===-" +
      "-===50===--===60===--===70===--===80===--===90===-";

      lessons[1] = 'The quick brown fox jumps over the lazy dog.⏎' +
                   'Aa Bb Cc Dd Ee Ff Gg Hh Ii Jj Kk Ll Mm Nn Oo Pp Qq Rr Ss Tt Uu Vv Ww Xx Yy Zz 0123456789';

      lessons[2] = 'The quick brown fox⏎jumps over the lazy dog. This line should be long enough to wrap onto the following line without manual carriage return...';

      lessons[3] = 'you might be one of those people that perform';

      lessons[4] = 'the quick brown fox jumps over the lazy dog... at least that\'s what it looked like to me.';

      var caret;
      var glyphs = [];
      var cssClasses = [];
      var htmlSpans = [];
      var wordLengths = [];
      var lineStartsAt = []; //contains index of glyphs that start lines

      loadLesson(4);

      function loadLesson(n) {
        //reset the lesson state
        caret = 0;
        glyphs = [];
        htmlSpans = [];
        cssClasses = [];
        wordLengths = [];
        
        var lesson = lessons[n];
        var wordLength = 0;
        for (var g = 0; g < lesson.length; g++) {
          glyphs[g] = (lesson[g] == ' ') ? '&nbsp;' : lesson[g];
          cssClasses[g] = ''; //initialize the class for each glyph
          htmlSpans[g] = glyphs[g];

          /* computes and stores the length of each word includes trailing space and CR symbol to avoid starting a line with a space or CR */
          wordLength++;
          if (glyphs[g] == '&nbsp;') { 
            wordLengths.push(wordLength)
            wordLength = 0;
          } else if (glyphs[g] == '⏎') { 
            wordLengths.push(wordLength + 1);
            wordLength = 0;
          }
        }

        //needed because above loop doesn't include last word length
        if(wordLength != 0) { wordLengths.push(wordLength); }

        reflowText();
      }

      /* reflow text ---------------------------------------------- */

      function reflowText() {
        var wordNumber = 0;
        var lineNumber = 0;
        var lineUsage = 0;
        const lineCapacity = measureLineCapacity();

        lineStartsAt = []; //resets
        lineStartsAt[0] = 0;
        for (var g = 0; g < glyphs.length; g++) {
          var carriageReturn = false;
          lineUsage++;
          if (lineUsage == lineCapacity) { 
            // sets flag if the line is full
            carriageReturn = true; 
          } else if (glyphs[g] == '⏎') { 
            // sets flag if the glyph is a carriage return
            carriageReturn = true; 
          } else if (glyphs[g] == '&nbsp;') {
            // sets flag if next word won't fit on line
            // (but only if the word can fit on a line)
            wordNumber++;
            var nextWordLength = wordLengths[wordNumber];
            var fit = nextWordLength <= (lineCapacity - lineUsage);
            var fitsOnNextLine = nextWordLength <= lineCapacity;
            // alert(nextWordLength + ", " + fit + ", " + fitsOnNextLine);
            if (!fit && fitsOnNextLine) { carriageReturn = true }
          }

          if (carriageReturn == true) {
            lineStartsAt.push(g+1);
            lineNumber++;
            lineUsage = 0;
          }
        }

        renderLines();
        $('paper').style.backgroundColor = 'green';
      }

      function renderLines() {
        //NOTE currentLine SHOULD BE COMPUTED FROM CARET
        var currentLine = 0;
        var start = (currentLine == 0) ? 0 : (currentLine - 1);
        //var limit = (currentLine == 0) ? (currentLine + 3) : (currentLine + 2);
        start = 0;
        var limit = 3;

        $('paper').children[0].innerHTML = '';
        $('paper').children[1].innerHTML = '';
        $('paper').children[2].innerHTML = '';
        // $('chordak').innerHTML += ', ' + lineStartsAt[0] + ' ' + lineStartsAt[1] + ' ' + lineStartsAt[2];
        
        //concatenate the spans and replace lines on paper
        for (var i = start; i < limit; i++) {
          var innerHTML = '';

          if (g >= glyphs.length) {
            innerHTML = 'empty line';
          } else {
            var g = lineStartsAt[i]
            var max = (lineStartsAt.length > i+1) ? lineStartsAt[i+1] : 
                                                    (glyphs.length);
            while(g < max) {
              if (htmlSpans[g] == '') { alert('span fail'); }
              innerHTML += htmlSpans[g];
              g++;
            }
          }

          $('paper').children[i].innerHTML = innerHTML;
        }


        // var lineCount = (lineIndex > 2) ? 3 : lineIndex +1;

        // for (var i = 0; i < lineCount; i++) {
        //  $('paper').children[i].innerHTML = lines[i];
        // }
      }

      function measureLineCapacity() {
        const lineWidth = $('paper').children[0].clientWidth;
        const fontSizeString = window.getComputedStyle($('paper')).getPropertyValue("font-size");
        const fontSize = Number(fontSizeString.slice(0,fontSizeString.length-2));
        const capacity = Math.floor(lineWidth / (10.25 * fontSize/17));
        // $('chordak').innerHTML = lineWidth + ' ' + capacity;
        return capacity
      }

      function changeState() {
                /*
        cssClasses[15] = 'm';

        for (var i = 0; i < glyphs.length; i++) {

          var open = '<span class="' + cssClasses[i] + '">';
          var glyph = glyphs[i];
          var close = '</span>';
          
          if(glyph == ' ') {
            breaks.push(i);
            //special case for mistake on space (note: ␣ is U+2423)
            if (cssClasses[i] == 'm') { glyph = '␣'; }
          }
          //concatenate the tags to produce the finished span
          spans[i] = open + glyph + close;
          if (i > 13 && i < 16) { alert(spans[i]); } 
        }
        */
      }


      /* asides ----------------------------------------------- */

      var asideOpen = null;
      $('aside-left').addEventListener('click', toggleAside);
      $('aside-right').addEventListener('click', toggleAside);
      
      function toggleAside(e) {
        // if no aside is open, go ahead and open one now
        if (asideOpen == null) {
          asideOpen = e.currentTarget;
          asideOpen.classList.add('open');
          e.stopPropagation(); // may be unnecessay
          document.body.style.cursor = 'pointer';
          document.body.addEventListener('click', toggleAside);

        // if an aside is open, closes on click out of aside
        } else if (!asideOpen.contains(e.target)) {
          document.body.style.cursor = 'auto';
          document.body.removeEventListener('click', toggleAside);
          asideOpen.classList.remove('open');
          asideOpen = null;
        }
        // otherwise, ignore the event
      }

      /* switch typing hand ----------------------------------- */

      $('typing-hand').addEventListener("change", switchHand);

      function switchHand(e) {
        var keyboard = $('keyboard');
        var overlay = $('overlay');
        let [remove, add, text] = e.currentTarget.checked ? 
            ['left', 'right', 'R'] : ['right', 'left', 'L'];
        
        keyboard.classList.remove(remove);
        overlay.classList.remove(remove);

        keyboard.classList.add(add);          
        overlay.classList.add(add);
        $('typing-hand-text').innerHTML = text;
      }

      /* standard keyboard layout ----------------------------- */
      
      //var home = [' ', 'F', 'D', 'S', 'A']; //qwerty
      //var home = [' ', 'T', 'S', 'R', 'A']; //colemak left
      //var home = [' ', 'N', 'E', 'I', 'O']; //colemak right
      
      /* reflow lesson text on resize ------------------------- */
      
      window.addEventListener('resize', debounceResize);

      // var textarea = document.getElementById("text");
      var w0 = $('paper').clientWidth; //no counting border
      var resizeTimeout;
      function debounceResize(event) {
        let w = $('paper').clientWidth;
        if (w != w0) {
          //only runs if width of writing area has changed
          window.clearTimeout(resizeTimeout);
          resizeTimeout = window.setTimeout(reflowText, 200);
          $('paper').style.backgroundColor = 'red';
          w0 = w;
        }
      }

      /* typing analysis  ------------------------------------- */

      // var speed = document.getElementById("speed");
      // var timer = document.getElementById("timer");

      /* keyboard input --------------------------------------- */

      window.addEventListener("keydown", keydownHandler);
      window.addEventListener("keyup", keyupHandler);

      var chords = {};      

      //LETTERS
      chords['t'] = '&nbsp;';
      chords['rmi'] = ',';
      chords['prm'] = '.';

      chords['i'] = 'e';
      chords['m'] = 't';
      chords['r'] = 'a';
      chords['p'] = 'o';
      chords['mi'] = 'i';
      chords['rm'] = 'n';
      chords['ri'] = 's';
      chords['rt'] = 'h';
      chords['mt'] = 'r';
      chords['it'] = 'd';
      chords['im'] = 'l';
      chords['pt'] = 'c';
      chords['pi'] = 'u';
      chords['pm'] = 'm';
      chords['ir'] = 'f';
      chords['mr'] = 'p';
      chords['tm'] = 'g';
      chords['ti'] = 'w';
      chords['tr'] = 'y';
      chords['pr'] = 'b';
      chords['tp'] = 'v';
      chords['ip'] = 'k';
      chords['rmt'] = 'x';
      chords['mit'] = 'j';
      chords['mp'] = 'q';
      chords['rp'] = 'z';



      var errorSound = $('mistake-sound');
      errorSound.preload = true;

      var undefinedSound = $('mistake-sound');
      // $('undefined-sound');
      undefinedSound.preload = true;

      var raw = '';
      var pressed = [];
      var count = 0;
      var writing = '';

      // var start = 0;

      var repeatCount = 0;
      var keydownCount = 0;

      var enabled = true;

      var startTime = 0;
      var speedTimeout;

      function timeoutHandler() {
        var elapsed = (Date.now() - startTime) / 1000;
        var error = elapsed - Math.floor(elapsed);
        error = Math.floor(error * 1000);
        timer.innerHTML = Math.floor(elapsed);
        if (elapsed < 60) {
          speedTimeout = window.setTimeout(timeoutHandler, 1000-error);
        }
      }

      //  9, 81, 87, 70, 80 
      //  8, 65, 82, 83, 84
      // 16, 90, 88, 67, 86
      //       18, 91, 32

      //  8 backspace
      //  9 tab
      // 16 shift
      // 20 capslock
      // 18 option/alt
      // 91 command
      // 32 space

        var keys = {};

        keys[65]  = 'p'; //A
        keys[82] = 'r'; //R
        keys[83] = 'm'; //S
        keys[84] = 'i'; //T
        keys[32] = 't'; //space

      //since the keyboard behavior should be essentially the same during
      //the different modes, one function will handle typing for all the
      //modes with conditionals for any added or removed functionality
      function keydownHandler(e) {
        if (!enabled) { return; }
        e.preventDefault();

        //
        if(caret == 0) { timer('start'); }

        var key = e.which;
        var letter = String.fromCharCode(key);
        //$('chordak').innerHTML = (letter == ' ') ? '&#9251;' : letter;
        if(e.repeat == true) { 
          //$('chordak').innerHTML = (letter == ' ') ? ' held &#9251;' : 'held ' + letter;
          return;
        }     
        
        if (keys[key]) {
          raw += keys[key];
          count++;
        }
        $('chordak').innerHTML = count;

        //prevents scrolling when pressing spacebar
        // if (key == 32) {
        //  e.preventDefault();
        // }
        //if (key == 9) {
        //  e.preventDefault();
        //}

        //alert(key);

        // if (key == 8 || key == 20) {
        //  e.preventDefault();
        //  writing = writing.slice(0, writing.length-1);
        //  practice.innerHTML = writing;
        // }
        // if (start == 0 && count != 0) {
        //  start = Date.now();
        //  speedTimeout = window.setTimeout(timeoutHandler, 1000);
        //  timer.innerHTML = '0';
        //  speed.innerHTML = '-';
        // }
      }


      function keyupHandler(e) {
        if (!enabled) { return; }
        e.preventDefault();

        var key = e.which;
        if (keys[key]) {
          count--;
        }
        $('chordak').innerHTML = count;

        if (count == 0) {
          if (chords[raw]) {
            var glyph = glyphs[caret];

            var letter = chords[raw];
            if(letter == glyphs[caret]) {
              cssClasses[caret] = 'c';
            } else {
              cssClasses[caret] = 'm';
              if (glyph == '&nbsp;') {
                glyph = '␣';
              }
              
              errorSound.pause();
              errorSound.currentTime = 0;
              errorSound.play();
            }

            var open = '<span class="' + cssClasses[caret] + '">';
            
            var close = '</span>';
            htmlSpans[caret] = open + glyph + close;

            caret++;

            if(caret < glyphs.length) {
              //only advance the caret when lesson isn't over
              cssClasses[caret] = 'caret';
              var open = '<span class="' + cssClasses[caret] + '">';
              var glyph = glyphs[caret];
              var close = '</span>';
              htmlSpans[caret] = open + glyph + close;
            } else {
              timer('stop');
              enabled = false;
            }
          } else {
            //take action here if undefined keys are pressed
            //perhaps show the incorrect chord below in yellow
            undefinedSound.pause();
            undefinedSound.currentTime = 0;
            undefinedSound.play();

            cssClasses[caret] = 'undefined';
              var open = '<span class="' + cssClasses[caret] + '">';
              var glyph = glyphs[caret];
              var close = '</span>';
              htmlSpans[caret] = open + glyph + close;
          }
          renderLines();
          raw = '';
        }

        // if (count == 0) {
        //  var letter = chords[raw];
        //  $('chordak').innerHTML += (' = ' + letter);
        //  raw = '';
        // }

        // used to do erase
        // //special case for caps lock being turned off
        // if (key == 20) {
        //  e.preventDefault();
        //  writing = writing.slice(0, writing.length-1);
        //  practice.innerHTML = writing;
        //  // x.innerHTML = "<small>&#9003;</small>";
        //  // x2.innerHTML = "backspace";
        // }

        // if (count == 0) {
        //  if(chords[raw]) {
        //    // x.innerHTML = raw;
        //    // x2.innerHTML = chords[raw];
        //    //writing += raw + "_"; //use for getting raw output
        //    writing += chords[raw].toLowerCase();
        //    practice.innerHTML = writing;
        //  } else {
        //    if (key != 8 || key != 20) {
        //      // x2.innerHTML = "unassigned";
        //    }
            
        //  }
        //  raw = "";

        //  if(start != 0 && writing == test) {
        //    window.clearTimeout(speedTimeout);
        //    var elapsed = Date.now() - start; //ms
        //    var seconds = Math.round(elapsed / 100) / 10;
        //    var wpm = (test.length / 5) / (elapsed / 1000 / 60);
        //    wpm = Math.round(wpm * 10) / 10;

        //    //speed.innerHTML = wpm.toFixed(1);
        //    //timer.innerHTML = seconds.toFixed(1);

        //    start = 0;
        //    writing = "";
        //  }
        // }
      }

      function timer(action) {
        if (action == 'start') {
          startTime = Date.now();
          speedTimeout = window.setTimeout(timeoutHandler, 1000);
          // timer.innerHTML = '0';
          $('chordak').innerHTML = '- wpm';
        } else if (action == 'stop') {
            window.clearTimeout(speedTimeout);
            var elapsed = Date.now() - startTime; //ms
            var seconds = Math.round(elapsed / 100) / 10;
            var wpm = (glyphs.length / 5) / (elapsed / 1000 / 60);
            wpm = Math.round(wpm * 10) / 10;

            $('chordak').innerHTML = wpm + ' wpm';
            //writing = "";
        }
      }

      /* audio ----------------------------------------- */

      /* setup ----------------------------------------- */

      // loadLesson(0);

      //create the context for the web audio
      // var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      // //create, tune, start and connect each oscillator sinea, sineb and sinec
      // var sinea = audioCtx.createOscillator();
      // sinea.frequency.value = 16500;
      // sinea.type = "sine";
      // sinea.start();
      // sinea.connect(audioCtx.destination);

    </script>
  </body>
</html>